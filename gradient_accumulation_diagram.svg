<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 800">
  <!-- White background -->
  <rect width="900" height="800" fill="white"/>

  <!-- Title -->
  <text x="450" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">
    Gradient Accumulation: 2 Samples → Single Neuron → Backward Once
  </text>

  <!-- Section: Sample 1 -->
  <text x="150" y="70" font-size="16" font-weight="bold" fill="#1976d2">Sample 1</text>

  <!-- Sample 1 inputs -->
  <circle cx="100" cy="120" r="15" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="100" y="125" font-size="10" text-anchor="middle" fill="#1976d2">x₁[0]</text>
  <text x="100" y="155" font-size="10" text-anchor="middle" fill="#666">2.0</text>
  <text x="145" y="125" font-size="9" fill="#999">(NEW)</text>

  <circle cx="100" cy="200" r="15" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="100" y="205" font-size="10" text-anchor="middle" fill="#1976d2">x₁[1]</text>
  <text x="100" y="235" font-size="10" text-anchor="middle" fill="#666">0.5</text>
  <text x="145" y="205" font-size="9" fill="#999">(NEW)</text>

  <!-- Sample 1 neuron -->
  <circle cx="280" cy="160" r="25" fill="#fff3e0" stroke="#f57c00" stroke-width="3"/>
  <text x="280" y="168" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">N</text>

  <!-- Connections Sample 1 -->
  <line x1="115" y1="120" x2="255" y2="160" stroke="#1976d2" stroke-width="2" opacity="0.5"/>
  <text x="180" y="130" font-size="10" fill="#f57c00">w[0]</text>

  <line x1="115" y1="200" x2="255" y2="160" stroke="#1976d2" stroke-width="2" opacity="0.5"/>
  <text x="180" y="190" font-size="10" fill="#f57c00">w[1]</text>

  <!-- Sample 1 output -->
  <circle cx="400" cy="160" r="15" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="400" y="165" font-size="10" text-anchor="middle" fill="#388e3c">out₁</text>
  <text x="445" y="165" font-size="9" fill="#999">(NEW)</text>
  <line x1="305" y1="160" x2="385" y2="160" stroke="#f57c00" stroke-width="2"/>

  <!-- Sample 1 loss -->
  <rect x="480" y="145" width="50" height="30" fill="#ffcdd2" stroke="#c62828" stroke-width="2" rx="5"/>
  <text x="505" y="165" font-size="11" font-weight="bold" text-anchor="middle" fill="#c62828">loss₁</text>
  <line x1="415" y1="160" x2="480" y2="160" stroke="#388e3c" stroke-width="2"/>

  <!-- Section: Sample 2 -->
  <text x="150" y="310" font-size="16" font-weight="bold" fill="#7b1fa2">Sample 2</text>

  <!-- Sample 2 inputs -->
  <circle cx="100" cy="360" r="15" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="100" y="365" font-size="10" text-anchor="middle" fill="#7b1fa2">x₂[0]</text>
  <text x="100" y="395" font-size="10" text-anchor="middle" fill="#666">3.0</text>
  <text x="145" y="365" font-size="9" fill="#999">(NEW)</text>

  <circle cx="100" cy="440" r="15" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="100" y="445" font-size="10" text-anchor="middle" fill="#7b1fa2">x₂[1]</text>
  <text x="100" y="475" font-size="10" text-anchor="middle" fill="#666">-1.0</text>
  <text x="145" y="445" font-size="9" fill="#999">(NEW)</text>

  <!-- Sample 2 neuron -->
  <circle cx="280" cy="400" r="25" fill="#fff3e0" stroke="#f57c00" stroke-width="3"/>
  <text x="280" y="408" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">N</text>

  <!-- Connections Sample 2 -->
  <line x1="115" y1="360" x2="255" y2="400" stroke="#7b1fa2" stroke-width="2" opacity="0.5"/>
  <text x="180" y="370" font-size="10" fill="#f57c00">w[0]</text>

  <line x1="115" y1="440" x2="255" y2="400" stroke="#7b1fa2" stroke-width="2" opacity="0.5"/>
  <text x="180" y="430" font-size="10" fill="#f57c00">w[1]</text>

  <!-- Sample 2 output -->
  <circle cx="400" cy="400" r="15" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="400" y="405" font-size="10" text-anchor="middle" fill="#388e3c">out₂</text>
  <text x="445" y="405" font-size="9" fill="#999">(NEW)</text>
  <line x1="305" y1="400" x2="385" y2="400" stroke="#f57c00" stroke-width="2"/>

  <!-- Sample 2 loss -->
  <rect x="480" y="385" width="50" height="30" fill="#ffcdd2" stroke="#c62828" stroke-width="2" rx="5"/>
  <text x="505" y="405" font-size="11" font-weight="bold" text-anchor="middle" fill="#c62828">loss₂</text>
  <line x1="415" y1="400" x2="480" y2="400" stroke="#388e3c" stroke-width="2"/>

  <!-- Total Loss -->
  <rect x="600" y="260" width="80" height="40" fill="#fff59d" stroke="#f57f17" stroke-width="3" rx="5"/>
  <text x="640" y="278" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">total_loss</text>
  <text x="640" y="293" font-size="10" text-anchor="middle" fill="#666">(loss₁+loss₂)</text>

  <!-- Connections to total loss -->
  <line x1="530" y1="160" x2="600" y2="270" stroke="#c62828" stroke-width="2"/>
  <text x="560" y="210" font-size="11" fill="#c62828">+</text>

  <line x1="530" y1="400" x2="600" y2="290" stroke="#c62828" stroke-width="2"/>
  <text x="560" y="350" font-size="11" fill="#c62828">+</text>

  <!-- Average Loss -->
  <rect x="750" y="260" width="80" height="40" fill="#c8e6c9" stroke="#2e7d32" stroke-width="3" rx="5"/>
  <text x="790" y="278" font-size="12" font-weight="bold" text-anchor="middle" fill="#1b5e20">avg_loss</text>
  <text x="790" y="293" font-size="10" text-anchor="middle" fill="#666">(÷2)</text>

  <line x1="680" y1="280" x2="750" y2="280" stroke="#f57f17" stroke-width="2"/>
  <text x="715" y="273" font-size="11" fill="#f57f17">×0.5</text>

  <!-- Backward arrow -->
  <path d="M 790 310 L 790 350" stroke="#d32f2f" stroke-width="4" fill="none" marker-end="url(#arrowhead)"/>
  <text x="820" y="335" font-size="14" font-weight="bold" fill="#d32f2f">.backward()</text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="#d32f2f"/>
    </marker>
  </defs>

  <!-- Shared Parameters Box -->
  <rect x="200" y="500" width="500" height="130" fill="#e1f5fe" stroke="#0277bd" stroke-width="3" rx="10"/>
  <text x="450" y="525" font-size="16" font-weight="bold" text-anchor="middle" fill="#01579b">
    SHARED PARAMETERS (Created Once)
  </text>

  <!-- Parameter details -->
  <circle cx="280" cy="570" r="20" fill="#fff3e0" stroke="#f57c00" stroke-width="3"/>
  <text x="280" y="577" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">w[0]</text>
  <text x="280" y="610" font-size="10" text-anchor="middle" fill="#333">Same id for</text>
  <text x="280" y="623" font-size="10" text-anchor="middle" fill="#333">both samples!</text>

  <circle cx="450" cy="570" r="20" fill="#fff3e0" stroke="#f57c00" stroke-width="3"/>
  <text x="450" y="577" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">w[1]</text>
  <text x="450" y="610" font-size="10" text-anchor="middle" fill="#333">Same id for</text>
  <text x="450" y="623" font-size="10" text-anchor="middle" fill="#333">both samples!</text>

  <circle cx="620" cy="570" r="20" fill="#fff3e0" stroke="#f57c00" stroke-width="3"/>
  <text x="620" y="577" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">b</text>
  <text x="620" y="610" font-size="10" text-anchor="middle" fill="#333">Same id for</text>
  <text x="620" y="623" font-size="10" text-anchor="middle" fill="#333">both samples!</text>

  <!-- Gradient flow illustration -->
  <text x="450" y="670" font-size="14" font-weight="bold" text-anchor="middle" fill="#01579b">
    Gradients accumulate here from BOTH loss₁ and loss₂
  </text>

  <!-- Legend -->
  <rect x="50" y="680" width="800" height="110" fill="#fafafa" stroke="#666" stroke-width="2" rx="5"/>
  <text x="450" y="705" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">
    KEY INSIGHT
  </text>

  <text x="60" y="730" font-size="12" fill="#333">
    1. Parameters (w[0], w[1], b) are created ONCE with fixed memory addresses (id)
  </text>
  <text x="60" y="748" font-size="12" fill="#333">
    2. Each sample creates NEW intermediate Values (x, w×x, out) with different ids
  </text>
  <text x="60" y="766" font-size="12" fill="#333">
    3. Both computation graphs flow through the SAME parameter objects
  </text>
  <text x="60" y="784" font-size="12" fill="#333">
    4. Single avg_loss.backward() traverses both paths → gradients ADD at shared parameters
  </text>
</svg>
